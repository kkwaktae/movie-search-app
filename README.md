# movie-search-app

리액트 + 리코일 + 타입스크립트 + 로컬스토리지 쉽지않다..

 

리액트 훅인 useState, useRef, useEffect에 좀 적응됐나 싶더니

리코일과 타입스크립트, 로컬스토리지가 혼용되다보니

불필요한 렌더링, 타입에러, 상태 초기값 관리 등이 발목을 잡는다.

 

이 부분들은 특히 무한스크롤, 즐겨찾기, api요청 시에 큰 걸림돌이 되었다.

 

 

**무한스크롤

라이브러리를 안쓰고 기본기로 구현해보고 싶었다.

결과론적이지만, 기간이 정해져있는 프로젝트였기에 안되겠다 싶으면 라이브러리를 사용해서라도 구현했어야한다고 생각한다..

onScroll시 ul태그를 가진 main태그에 스크롤이 적용되더라..

아무튼 main태그의 스크롤 위치값과 ul태그의 height 값을 계산하여

스크롤 위치가 ul태그의 바닥에 도달했을 때 page(api 요청시 param의 요소 중 하나)을 +1 하고, 

변경된 page로 api가 재요청되는 무한스크롤 이벤트를 구현하고자 했다.

이때, 스크롤시 일어나는 수많은 이벤트때문에 api가 너무 많이 요청되어,

페이지가 1page에서 2page로 순차적으로 변경되는게 아니라,

스크롤 속도에 따라 1 > 7 > 11 > 19 이런식으로 몇몇 페이지들을 건너뛰는 상황이 발생했다.

이를 위해 디바운싱과 쓰로틀링을 이용해보려 했지만, 역량 부족으로 해결해내지 못했다...

이부분은 test파일을 만들어서 새로 학습해봐야겠다..

 

 

**즐겨찾기
로컬스토리지를 이용해서 데이터를 저장하는 방식으로 구현하려고 했다.

List 컴포넌트에서 즐겨찾기 버튼을 클릭하면 클릭된 movie의 정보가 담긴 객체를 리코일로 전역에 저장한 후,

Main 페이지로 전달하고 Main 페이지에 미리 만들어둔 modal을 띄웠다.

그리고 modal에서 다시 즐겨찾기 버튼을 클릭하면, 리코일로 전역에 저장해둔 movie 객체를 새 useState를 활용하여

상태를 관리했다.

이 과정에서 useState의 초기값에 []을 주고, 즐겨찾기 버튼을 클릭할 때마다 [...prev, movie객체] 했고, 

로컬스토리지에 제대로 저장되는 것을 확인할 수 있었다.

그러나 새로고침 시 로컬스토리지에 저장된 데이터가 []로 초기화되는 문제가 발생했다.

이부분을 계속 고민하고 있지만 여전히 해결하지 못하고 있다...

 

 

**후기
리액트 + 리코일 + 타입스크립트 + 로컬스토리지 작업을 하면서,

리액트의 useState와 리코일 state에서 변화가 생길 때마다 재렌더링이 되는 점 때문에 발생하는 문제나, 성능 저하가 많다는 것을 느꼈다..

또한, 타입 관리가 아직 익숙지 않아 작업이 중단되는 시간이 잦았다..

이러한 부분들은 꾸준히 학습하고 익숙해져야 개선될 것 같다..
